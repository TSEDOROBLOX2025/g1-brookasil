<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>g1 - Brookasil Oficial</title>
    <style>
        :root { 
            --g1-red: #C4170C; 
            --g1-bg: #f6f6f6; 
            --text-main: #333;
            --border: #ddd;
        }
        
        body { font-family: "Open Sans", Arial, sans-serif; margin: 0; background-color: var(--g1-bg); color: var(--text-main); }
        
        /* HEADER */
        header { background-color: var(--g1-red); color: white; padding: 0 20px; display: flex; align-items: center; position: sticky; top: 0; z-index: 1000; height: 65px; justify-content: space-between; }
        .logo { font-weight: 900; font-size: 34px; letter-spacing: -2px; cursor: pointer; color: white; text-decoration: none; }
        .logo span { font-weight: 400; font-size: 18px; letter-spacing: 0; margin-left: 5px; opacity: 0.8; }
        
        .user-pill { background: rgba(0,0,0,0.2); padding: 5px 12px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .user-avatar { width: 25px; height: 25px; border-radius: 50%; object-fit: cover; background: white; }

        /* NAVEGA√á√ÉO CATEGORIAS */
        .sub-nav { background: white; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: center; overflow-x: auto; position: sticky; top: 65px; z-index: 999; }
        .sub-nav a { color: var(--g1-red); text-decoration: none; padding: 15px; font-size: 12px; font-weight: 800; text-transform: uppercase; cursor: pointer; border-bottom: 3px solid transparent; }
        .sub-nav a:hover, .sub-nav a.active { border-bottom: 3px solid var(--g1-red); }

        .container { max-width: 1100px; margin: 20px auto; padding: 0 20px; min-height: 80vh; }
        .section { display: none; }
        .section.active { display: block; }

        /* CARDS */
        .news-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; border-bottom: 1px solid #ddd; cursor: pointer; }
        .card-img { width: 100%; height: 180px; object-fit: cover; }
        .card-body { padding: 15px; }
        .card-category { color: var(--g1-red); font-size: 11px; font-weight: 800; text-transform: uppercase; }
        .card-title { font-size: 20px; font-weight: 800; line-height: 1.2; margin: 10px 0; }

        /* PERFIL */
        .profile-card { background: white; padding: 30px; border-radius: 8px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .avatar-edit { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid var(--g1-red); margin-bottom: 15px; }

        /* FORMUL√ÅRIOS */
        .box { background: white; padding: 25px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 20px; }
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; font-size: 15px; box-sizing: border-box; }
        .btn { background: var(--g1-red); color: white; border: none; padding: 12px 20px; border-radius: 4px; font-weight: 800; cursor: pointer; width: 100%; transition: 0.2s; }
        .btn-outline { background: none; border: 1px solid var(--border); color: #666; width: auto; font-size: 12px; margin-right: 5px; }

        /* MODAL */
        #news-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 5000; overflow-y: auto; }
        .modal-content { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
        
        #toast { display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 25px; border-radius: 30px; z-index: 6000; font-weight: bold; }
    </style>
</head>
<body>

    <div id="toast">Sucesso!</div>

    <header>
        <div style="display:flex; align-items:center;">
            <span style="font-size:24px; margin-right:15px; cursor:pointer;" onclick="irPara('admin')">‚ò∞</span>
            <a class="logo" onclick="location.reload()">g1 <span>Brookasil</span></a>
        </div>
        <div class="user-pill" onclick="irPara('conta')">
            <img id="nav-avatar" class="user-avatar" src="https://via.placeholder.com/50">
            <span id="display-nome">Entrar</span>
        </div>
    </header>

    <div class="sub-nav">
        <a onclick="filtrar('Tudo')" class="active">Tudo</a>
        <a onclick="filtrar('Pol√≠tica')">Pol√≠tica</a>
        <a onclick="filtrar('Policial')">Policial</a>
        <a onclick="filtrar('Sa√∫de')">Sa√∫de</a>
        <a onclick="filtrar('Cidades')">Cidades</a>
    </div>

    <div class="container">
        <div id="sec-noticias" class="section active">
            <div id="feed" class="news-grid"></div>
        </div>

        <div id="sec-conta" class="section">
            <div class="profile-card">
                <img id="edit-preview" class="avatar-edit" src="https://via.placeholder.com/150">
                <h2>Meu Perfil</h2>
                <div class="box">
                    <label>Trocar Foto (Galeria):</label>
                    <input type="file" accept="image/*" onchange="previewImage(this, 'edit-preview')">
                    <input type="text" id="reg-nome" placeholder="Nome no RP">
                    <textarea id="reg-bio" placeholder="Sua Biografia..."></textarea>
                    <button class="btn" onclick="salvarPerfil()">Salvar Altera√ß√µes</button>
                </div>
            </div>
        </div>

        <div id="sec-admin" class="section">
            <div class="box">
                <h2>üîë Painel Administrativo</h2>
                <div id="admin-login">
                    <input type="password" id="admin-pass" placeholder="Senha do Painel">
                    <button class="btn" onclick="acessarAdmin()">Acessar</button>
                </div>
                
                <div id="admin-tools" style="display:none">
                    <div id="dono-tools" style="display:none">
                        <h3>üå°Ô∏è Clima (Apenas Dono)</h3>
                        <input type="text" id="clima-input" placeholder="Ex: ‚õàÔ∏è Temporal: 18¬∞C">
                        <button class="btn" onclick="setClima()">Mudar Clima</button>
                        <hr>
                    </div>

                    <h3>‚úçÔ∏è Postar Not√≠cia</h3>
                    <select id="n-tema">
                        <option value="Pol√≠tica">Pol√≠tica</option>
                        <option value="Policial">Policial</option>
                        <option value="Sa√∫de">Sa√∫de</option>
                        <option value="Cidades">Cidades</option>
                    </select>
                    <input type="text" id="n-tit" placeholder="T√≠tulo da Not√≠cia">
                    <textarea id="n-txt" rows="6" placeholder="Texto da reportagem..."></textarea>
                    <label>Foto da Not√≠cia (Galeria):</label>
                    <input type="file" accept="image/*" onchange="previewImage(this, 'n-img-prev')">
                    <img id="n-img-prev" style="width:100%; display:none; margin:10px 0; border-radius:5px;">
                    <button class="btn" onclick="postarNoticia()">Publicar Agora</button>
                </div>
            </div>
        </div>
    </div>

    <div id="news-modal">
        <div class="modal-content">
            <button class="btn" style="width:auto; margin-bottom:20px;" onclick="fecharModal()">‚Üê VOLTAR</button>
            <div id="modal-data"></div>
            
            <div style="margin: 20px 0; padding: 15px 0; border-top: 1px solid #eee;">
                <button class="btn btn-outline" onclick="social('Ameis')">‚ù§Ô∏è Amei</button>
                <button class="btn btn-outline" onclick="social('Republicados')">üîÑ Republicar</button>
                <button class="btn btn-outline" onclick="social('Seguidores')">üë§ Seguir Autor</button>
            </div>

            <h4>üí¨ Coment√°rios</h4>
            <div id="comments-box"></div>
            <div style="margin-top:20px; display:flex; gap:10px;">
                <input type="text" id="comm-input" placeholder="Escreva seu coment√°rio...">
                <button class="btn" style="width:120px;" onclick="enviarComentario()">Enviar</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = { databaseURL: "https://g1-brookasil-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let imagemBase64 = "";

        // FUN√á√ÉO PARA ACESSAR GALERIA
        function previewImage(input, targetID) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onloadend = function() {
                imagemBase64 = reader.result;
                document.getElementById(targetID).src = reader.result;
                document.getElementById(targetID).style.display = 'block';
            }
            if (file) reader.readAsDataURL(file);
        }

        // NAVEGA√á√ÉO E FILTROS
        function irPara(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('sec-' + id).classList.add('active');
            window.scrollTo(0,0);
        }

        function filtrar(tema) {
            document.querySelectorAll('.sub-nav a').forEach(a => a.classList.remove('active'));
            event.target.classList.add('active');
            carregarNoticias(tema);
            irPara('noticias');
        }

        // PERFIL
        function salvarPerfil() {
            const nome = document.getElementById('reg-nome').value;
            const bio = document.getElementById('reg-bio').value;
            if(nome) {
                const user = { nome, bio, foto: imagemBase64 };
                localStorage.setItem('g1_user', JSON.stringify(user));
                showToast("Perfil atualizado!");
                location.reload();
            }
        }

        function carregarUser() {
            const saved = localStorage.getItem('g1_user');
            if(saved) {
                const user = JSON.parse(saved);
                document.getElementById('display-nome').innerText = user.nome;
                if(user.foto) {
                    document.getElementById('nav-avatar').src = user.foto;
                    document.getElementById('edit-preview').src = user.foto;
                }
                document.getElementById('reg-nome').value = user.nome;
                document.getElementById('reg-bio').value = user.bio;
            }
        }

        // ADMINISTRA√á√ÉO
        function acessarAdmin() {
            const p = document.getElementById('admin-pass').value;
            if(p === "Brookasil1234") { // DONO
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-tools').style.display = 'block';
                document.getElementById('dono-tools').style.display = 'block';
            } else if (p === "G1_Brookasil") { // JORNALISTA
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-tools').style.display = 'block';
            } else { alert("Senha incorreta!"); }
        }

        // POSTAR NOT√çCIA
        function postarNoticia() {
            const t = document.getElementById('n-tit').value;
            const txt = document.getElementById('n-txt').value;
            const tema = document.getElementById('n-tema').value;
            if(t && txt) {
                db.ref('posts').push({
                    titulo: t, texto: txt, imagem: imagemBase64, tema: tema, data: Date.now()
                }).then(() => {
                    showToast("Not√≠cia publicada!");
                    location.reload();
                });
            }
        }

        // CARREGAR NOT√çCIAS
        function carregarNoticias(filtro = "Tudo") {
            db.ref('posts').on('value', s => {
                const feed = document.getElementById('feed');
                feed.innerHTML = "";
                s.forEach(item => {
                    const p = item.val();
                    if(filtro === "Tudo" || p.tema === filtro) {
                        feed.innerHTML += `
                            <div class="card" onclick="abrirNoticia('${item.key}')">
                                ${p.imagem ? `<img src="${p.imagem}" class="card-img">` : ''}
                                <div class="card-body">
                                    <span class="card-category">${p.tema}</span>
                                    <h2 class="card-title">${p.titulo}</h2>
                                </div>
                            </div>`;
                    }
                });
            });
        }

        let noticiaAtiva = "";
        function abrirNoticia(id) {
            noticiaAtiva = id;
            db.ref('posts/'+id).once('value', s => {
                const p = s.val();
                document.getElementById('modal-data').innerHTML = `
                    <span class="card-category">${p.tema}</span>
                    <h1 style="font-size:38px; line-height:1.1; margin:10px 0;">${p.titulo}</h1>
                    ${p.imagem ? `<img src="${p.imagem}" style="width:100%; border-radius:8px; margin:20px 0;">` : ''}
                    <p style="font-size:19px; color:#333; line-height:1.8;">${p.texto.replace(/\n/g, '<br>')}</p>
                `;
                document.getElementById('news-modal').style.display = 'block';
                document.body.style.overflow = 'hidden';
                carregarComentarios(id);
            });
        }

        // COMENT√ÅRIOS E SOCIAL
        function social(tipo) {
            showToast("Voc√™ ganhou +1 " + tipo);
        }

        function enviarComentario() {
            const user = JSON.parse(localStorage.getItem('g1_user') || '{"nome":"An√¥nimo"}');
            const msg = document.getElementById('comm-input').value;
            if(msg) {
                db.ref('comentarios/'+noticiaAtiva).push({ 
                    nome: user.nome, 
                    msg: msg,
                    foto: user.foto || "" 
                }).then(() => {
                    document.getElementById('comm-input').value = "";
                });
            }
        }

        function carregarComentarios(id) {
            db.ref('comentarios/'+id).on('value', s => {
                const box = document.getElementById('comments-box'); box.innerHTML = "";
                s.forEach(c => {
                    const d = c.val();
                    box.innerHTML += `
                        <div style="display:flex; gap:10px; margin-bottom:15px; align-items:center;">
                            <img src="${d.foto || 'https://via.placeholder.com/50'}" style="width:30px; height:30px; border-radius:50%; object-fit:cover;">
                            <p style="font-size:14px; margin:0;"><b>${d.nome}:</b> ${d.msg}</p>
                        </div>`;
                });
            });
        }

        function fecharModal() { 
            document.getElementById('news-modal').style.display = 'none'; 
            document.body.style.overflow = 'auto';
        }

        function showToast(m) { 
            const t = document.getElementById('toast'); t.innerText = m; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 3000);
        }

        function setClima() {
            const c = document.getElementById('clima-input').value;
            db.ref('clima').set(c).then(() => showToast("Clima atualizado!"));
        }

        // INICIALIZA√á√ÉO
        carregarUser();
        carregarNoticias();
    </script>
</body>
</html>
