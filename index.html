<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>g1 Brookasil - O portal de not√≠cias do RP</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --g1-red: #C4170C;
            --g1-dark: #a3130a;
            --bg-gray: #f2f2f2;
            --text-main: #111;
            --text-sub: #555;
            --border: #ddd;
            --white: #ffffff;
            --gold: #D4AF37;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Open Sans', sans-serif; }
        body { background-color: var(--bg-gray); color: var(--text-main); overflow-x: hidden; scroll-behavior: smooth; }
        
        /* --- ESPECIAL ANO NOVO --- */
        #ny-banner { display: none; background: linear-gradient(90deg, #0f0c29, #302b63, #24243e); color: #fff; padding: 12px; text-align: center; font-weight: 800; border-bottom: 3px solid var(--gold); position: relative; z-index: 2100; }
        .fw { position: absolute; width: 4px; height: 4px; background: gold; border-radius: 50%; opacity: 0; animation: firework 2s infinite; }
        @keyframes firework { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(15); opacity: 0; } }

        /* --- HEADER & NAV --- */
        header { background: var(--g1-red); height: 65px; display: flex; align-items: center; justify-content: space-between; padding: 0 4%; position: sticky; top: 0; z-index: 2000; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .h-left { display: flex; align-items: center; gap: 20px; }
        .menu-btn { color: white; font-size: 28px; cursor: pointer; user-select: none; }
        .logo { font-weight: 800; font-size: 34px; letter-spacing: -2px; color: white; text-decoration: none; cursor: pointer; }
        .logo span { font-weight: 400; font-size: 15px; letter-spacing: 0; margin-left: 4px; opacity: 0.9; }
        
        .user-pill { display: flex; align-items: center; gap: 10px; background: rgba(0,0,0,0.15); padding: 6px 16px; border-radius: 30px; color: white; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); transition: var(--transition); }
        .user-pill:hover { background: rgba(0,0,0,0.25); transform: translateY(-1px); }
        .user-pill img { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; background: #eee; }

        .sub-bar { background: white; border-bottom: 1px solid var(--border); padding: 10px 4%; display: flex; justify-content: space-between; align-items: center; font-size: 11px; font-weight: 700; color: var(--text-sub); }
        .live { color: #c00; display: flex; align-items: center; gap: 5px; }
        .live-dot { width: 8px; height: 8px; background: #c00; border-radius: 50%; animation: pulse 1s infinite; }

        .filter-nav { background: white; border-bottom: 1px solid var(--border); display: flex; justify-content: flex-start; overflow-x: auto; padding: 0 4%; sticky; top: 65px; z-index: 1000; scrollbar-width: none; }
        .filter-nav button { background: none; border: none; padding: 16px 18px; color: var(--g1-red); font-weight: 800; font-size: 12px; text-transform: uppercase; cursor: pointer; border-bottom: 3px solid transparent; transition: 0.2s; white-space: nowrap; }
        .filter-nav button.active { border-bottom-color: var(--g1-red); }

        /* --- SIDE MENU --- */
        #side-menu { position: fixed; top: 0; left: -320px; width: 300px; height: 100%; background: white; z-index: 3000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding: 40px 25px; box-shadow: 10px 0 40px rgba(0,0,0,0.15); }
        #side-menu.open { left: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2500; display: none; backdrop-filter: blur(2px); }
        .menu-link { display: block; padding: 15px 0; border-bottom: 1px solid #f0f0f0; color: var(--g1-red); font-weight: 800; text-decoration: none; text-transform: uppercase; font-size: 14px; cursor: pointer; }

        /* --- LAYOUT --- */
        .container { max-width: 1140px; margin: 25px auto; padding: 0 15px; display: grid; grid-template-columns: 1fr 320px; gap: 35px; }
        @media (max-width: 992px) { .container { grid-template-columns: 1fr; } .sidebar { display: none; } }

        /* --- CARDS --- */
        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .featured-card { grid-column: 1 / -1; background: white; border-radius: 8px; overflow: hidden; display: grid; grid-template-columns: 1.5fr 1fr; border-bottom: 4px solid var(--g1-red); margin-bottom: 40px; box-shadow: var(--shadow); cursor: pointer; }
        @media (max-width: 768px) { .featured-card { grid-template-columns: 1fr; } }
        
        .news-card { background: white; border-bottom: 1px solid var(--border); padding-bottom: 25px; margin-bottom: 25px; transition: var(--transition); cursor: pointer; }
        .news-card:hover .title { color: var(--g1-red); }
        .news-img { width: 100%; aspect-ratio: 16/9; object-fit: cover; border-radius: 4px; margin-bottom: 15px; }
        .cat { color: var(--g1-red); font-weight: 800; font-size: 11px; text-transform: uppercase; }
        .title { font-size: 24px; font-weight: 800; line-height: 1.2; margin: 8px 0; color: #111; }
        .sub { color: var(--text-sub); font-size: 15px; line-height: 1.4; }

        /* --- SIDEBAR BOXES --- */
        .box { background: white; padding: 25px; border-radius: 8px; border-top: 3px solid var(--g1-red); margin-bottom: 25px; box-shadow: var(--shadow); }
        .box h3 { font-size: 14px; text-transform: uppercase; margin-bottom: 20px; color: var(--text-sub); letter-spacing: 1px; }
        .trending-item { display: flex; gap: 15px; margin-bottom: 20px; cursor: pointer; }
        .rank { font-size: 24px; font-weight: 800; color: #ddd; }

        /* --- FORMS --- */
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: 700; font-size: 13px; margin-bottom: 6px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; transition: 0.2s; }
        input:focus { border-color: var(--g1-red); outline: none; box-shadow: 0 0 0 3px rgba(196, 23, 12, 0.1); }
        .btn { background: var(--g1-red); color: white; border: none; padding: 14px 25px; font-weight: 800; border-radius: 6px; cursor: pointer; width: 100%; text-transform: uppercase; }
        .btn:hover { background: var(--g1-dark); }
        .btn-outline { background: #f9f9f9; color: #333; border: 1px solid var(--border); }

        /* --- MODAL --- */
        #modal-view { position: fixed; inset: 0; background: white; z-index: 4000; display: none; overflow-y: auto; padding: 60px 5%; }
        .modal-body { max-width: 800px; margin: 0 auto; }
        .modal-title { font-size: 42px; font-weight: 800; line-height: 1.1; margin-bottom: 20px; }
        .modal-sub { font-size: 20px; color: var(--text-sub); margin-bottom: 30px; }
        .modal-content { font-size: 19px; line-height: 1.8; color: #333; }

        /* --- TOAST --- */
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 30px; border-radius: 50px; display: none; z-index: 5000; font-weight: 600; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="ny-banner">
        üéÜ ESPECIAL DE ANO NOVO g1 BROOKASIL üéÜ
        <div id="countdown" style="font-size: 12px; margin-top: 5px; color: gold;"></div>
        <div class="fw" style="left:10%; top:20%"></div>
        <div class="fw" style="right:15%; top:50%"></div>
    </div>

    <div id="toast">A√ß√£o conclu√≠da!</div>
    <div class="overlay" id="overlay" onclick="toggleMenu(false)"></div>

    <div id="side-menu">
        <div style="font-size: 24px; font-weight: 800; color: var(--g1-red); margin-bottom: 30px;">g1 Brookasil</div>
        <a class="menu-link" onclick="navigate('home')">Home</a>
        <a class="menu-link" onclick="navigate('conta')">Minha Conta</a>
        <a class="menu-link" onclick="navigate('admin')">Painel Administrativo</a>
        <a class="menu-link" onclick="navigate('candidatura')">Candidatura CDE</a>
        <a class="menu-link" onclick="navigate('filiacao')">Filia√ß√£o Partid√°ria</a>
        <a class="menu-link" onclick="navigate('divulgar')">Divulgar Trabalho</a>
    </div>

    <header>
        <div class="h-left">
            <div class="menu-btn" onclick="toggleMenu(true)">‚ò∞</div>
            <a class="logo" onclick="navigate('home')">g1<span>Brookasil</span></a>
        </div>
        <div class="user-pill" onclick="navigate('conta')">
            <img id="nav-pfp" src="https://via.placeholder.com/50">
            <span id="nav-user">Acessar Conta</span>
        </div>
    </header>

    <div class="sub-bar">
        <div class="live"><div class="live-dot"></div> AO VIVO</div>
        <div id="clima-display">‚òÄÔ∏è ENSOLARADO: 28¬∞C</div>
        <div id="relogio-display">00:00:00</div>
    </div>

    <nav class="filter-nav" id="filter-bar">
        <button class="active" onclick="setFilter('Todas', this)">Todas</button>
        <button onclick="setFilter('Pol√≠tica', this)">Pol√≠tica</button>
        <button onclick="setFilter('Pol√≠cia', this)">Pol√≠cia</button>
        <button onclick="setFilter('Economia', this)">Economia</button>
        <button onclick="setFilter('Sa√∫de', this)">Sa√∫de</button>
        <button onclick="setFilter('Elei√ß√µes', this)">Elei√ß√µes</button>
        <button onclick="setFilter('Brookasil RP', this)">Brookasil RP</button>
        <button onclick="setFilter('Cultura', this)">Cultura</button>
        <button onclick="setFilter('Tecnologia', this)">Tecnologia</button>
    </nav>

    <div class="container">
        <main>
            <div style="margin-bottom: 30px;">
                <input type="text" id="search-in" placeholder="üîç O que voc√™ est√° procurando?" oninput="searchNews()" style="background: white; border: none; box-shadow: var(--shadow);">
            </div>

            <section id="sec-home" class="section active">
                <div id="news-feed">
                    <p style="text-align: center; padding: 50px; color: #999;">Conectando ao banco de dados do g1...</p>
                </div>
            </section>

            <section id="sec-conta" class="section">
                <div class="box">
                    <h2 id="auth-title">Meu Perfil</h2>
                    <div id="auth-ui">
                        </div>
                </div>
            </section>

            <section id="sec-candidatura" class="section">
                <div class="box" style="border-top-color: #0645ad;">
                    <h2 style="margin-bottom:20px;">Candidaturas ‚Äì CDE Brookasil</h2>
                    <p style="margin-bottom:20px; line-height:1.6;">O Conselho de √âtica e Desenvolvimento (CDE) √© o pilar da nossa sociedade. Siga os passos abaixo para submeter sua candidatura oficial.</p>
                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                        <p><strong>1.</strong> Acesse o portal oficial do governo.</p>
                        <p><strong>2.</strong> Preencha o formul√°rio com dados reais.</p>
                        <p><strong>3.</strong> Aguarde o per√≠odo de an√°lise da junta eleitoral.</p>
                    </div>
                    <button class="btn" onclick="window.open('https://tsedoroblox2025.github.io/candidatura-cde/')">Acessar Sistema de Candidatura</button>
                </div>
            </section>

            <section id="sec-filiacao" class="section">
                <div class="box" style="border-top-color: #28a745;">
                    <h2 style="margin-bottom:20px;">Filia√ß√£o Partid√°ria</h2>
                    <p style="margin-bottom:20px;">Escolha o seu lado e ajude a construir o futuro de Brookasil. A filia√ß√£o √© gratuita e permite sua participa√ß√£o ativa em decis√µes pol√≠ticas.</p>
                    <button class="btn" style="background: #28a745;" onclick="window.open('https://tsedoroblox2025.github.io/filia-o.html/')">Fazer Filia√ß√£o Agora</button>
                </div>
            </section>

            <section id="sec-divulgar" class="section">
                <div class="box">
                    <h2>Divulgar Trabalho</h2>
                    <p>Anuncie sua empresa no maior portal do RP. Nossos planos de publicidade alcan√ßam todos os cidad√£os.</p>
                    <br>
                    <input type="text" placeholder="Nome da Empresa">
                    <textarea placeholder="Descreva sua proposta publicit√°ria..."></textarea>
                    <button class="btn">Enviar Proposta</button>
                </div>
            </section>

            <section id="sec-admin" class="section">
                <div id="admin-lock">
                    <div class="box">
                        <h2>Painel Administrativo</h2>
                        <p>Acesso restrito para Jornalistas e Dono.</p>
                        <br>
                        <button class="btn btn-outline" onclick="navigate('conta')">Fazer Login para Acessar</button>
                    </div>
                </div>

                <div id="admin-panel" style="display:none;">
                    <div id="dono-only" class="box" style="display:none; background: #fffdf2; border-color: gold;">
                        <h3>üëë Ferramentas do Dono</h3>
                        <label>Atualizar Clima:</label>
                        <input type="text" id="cfg-clima" placeholder="Ex: ‚õàÔ∏è TEMPESTADE: 22¬∞C">
                        <button class="btn" style="background:#333; margin-top:10px;" onclick="saveClima()">Salvar Topo</button>
                    </div>

                    <div class="box">
                        <h3>‚úçÔ∏è Publicar Not√≠cia</h3>
                        <div class="form-group">
                            <label>üìå T√≠tulo</label>
                            <input type="text" id="n-titulo" placeholder="O que aconteceu?">
                        </div>
                        <div class="form-group">
                            <label>üßæ Subt√≠tulo</label>
                            <input type="text" id="n-sub" placeholder="Resumo da not√≠cia">
                        </div>
                        <div class="form-group">
                            <label>üè∑Ô∏è Tema</label>
                            <select id="n-tema">
                                <option>Pol√≠tica</option><option>Pol√≠cia</option><option>Economia</option>
                                <option>Sa√∫de</option><option>Tecnologia</option><option>Cultura</option>
                                <option>Entretenimento</option><option>Elei√ß√µes</option><option>Brookasil RP</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‚úçÔ∏è Autor</label>
                            <select id="n-autor">
                                <option>Tutu Prot√°sio</option>
                                <option>Reda√ß√£o g1</option>
                                <option>Jornalismo Oficial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üì∞ Conte√∫do</label>
                            <textarea id="n-texto" rows="10" placeholder="Escreva a not√≠cia completa..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>üñºÔ∏è Foto da Not√≠cia</label>
                            <input type="file" accept="image/*" onchange="previewImg(this, 'n-prev')">
                            <img id="n-prev" style="width:100%; border-radius:8px; display:none; margin-top:15px; border:1px solid #ddd;">
                        </div>
                        <button class="btn" onclick="publishNews()">Publicar no g1 Brookasil</button>
                    </div>
                </div>
            </section>
        </main>

        <aside class="sidebar">
            <div class="box">
                <h3>MAIS LIDAS</h3>
                <div id="trending-list"></div>
            </div>
            <div class="box" style="background: var(--g1-red); color: white; border: none;">
                <h3 style="color: white;">Fique Ligado</h3>
                <p style="font-size: 13px;">Receba alertas de plant√£o direto no seu dispositivo.</p>
                <button class="btn" style="background: white; color: var(--g1-red); margin-top: 15px;">Ativar Alertas</button>
            </div>
        </aside>
    </div>

    <div id="modal-view">
        <div class="modal-body">
            <button class="btn btn-outline" style="width:auto; margin-bottom:30px;" onclick="closeModal()">‚Üê VOLTAR</button>
            <div id="modal-data"></div>
            <div style="margin-top:40px; border-top: 1px solid #eee; padding-top:20px;">
                <p style="font-weight:800; margin-bottom:15px;">O que voc√™ achou desta not√≠cia?</p>
                <div style="display:flex; gap:15px;">
                    <button class="btn btn-outline" onclick="react('likes')">üëç <span id="v-likes">0</span></button>
                    <button class="btn btn-outline" onclick="react('unlikes')">üëé <span id="v-unlikes">0</span></button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // --- CONFIG ---
        const firebaseConfig = { databaseURL: "https://g1-brookasil-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- STATE ---
        let currentUser = JSON.parse(localStorage.getItem('g1_session')) || null;
        let allNews = [];
        let currentFilter = "Todas";
        let tempImg = "";
        let activePostId = null;

        // --- NAVIGATION ---
        function navigate(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('sec-' + id).classList.add('active');
            toggleMenu(false);
            if(id === 'conta') renderAuthUI();
            if(id === 'admin') checkAdminAccess();
            window.scrollTo(0,0);
        }

        function toggleMenu(show) {
            document.getElementById('side-menu').classList.toggle('open', show);
            document.getElementById('overlay').style.display = show ? 'block' : 'none';
        }

        function toast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 3000);
        }

        // --- AUTH SYSTEM ---
        function renderAuthUI() {
            const container = document.getElementById('auth-ui');
            if (currentUser) {
                container.innerHTML = `
                    <div style="text-align:center;">
                        <img src="${currentUser.pfp}" style="width:100px; height:100px; border-radius:50%; border:3px solid var(--g1-red); margin-bottom:15px;">
                        <h2>${currentUser.nome}</h2>
                        <p style="color:var(--text-sub)">Cargo: <strong>${currentUser.role}</strong></p>
                        <br>
                        <button class="btn" style="background:#333" onclick="logout()">Sair da Conta</button>
                    </div>`;
            } else {
                container.innerHTML = `
                    <div class="form-group"><label>Nome</label><input type="text" id="log-nome"></div>
                    <div class="form-group"><label>Senha</label><input type="password" id="log-pass"></div>
                    <div id="reg-fields" style="display:none;">
                        <div class="form-group"><label>Sua Foto (URL ou Galeria)</label>
                        <input type="file" accept="image/*" onchange="previewImg(this, 'reg-prev')">
                        <img id="reg-prev" style="width:60px; height:60px; border-radius:50%; display:none; margin:10px auto;"></div>
                    </div>
                    <button class="btn" id="auth-btn" onclick="login()">Entrar</button>
                    <p style="text-align:center; margin-top:15px; font-size:13px; cursor:pointer;" onclick="toggleAuthMode(this)">N√£o tenho conta. Cadastrar!</p>`;
            }
            updateHeader();
        }

        function toggleAuthMode(el) {
            const reg = document.getElementById('reg-fields');
            const btn = document.getElementById('auth-btn');
            const title = document.getElementById('auth-title');
            if (reg.style.display === 'none') {
                reg.style.display = 'block';
                btn.innerText = "Criar Minha Conta";
                btn.onclick = register;
                title.innerText = "Novo Cadastro";
                el.innerText = "J√° tenho conta. Fazer Login!";
            } else {
                reg.style.display = 'none';
                btn.innerText = "Entrar";
                btn.onclick = login;
                title.innerText = "Meu Perfil";
                el.innerText = "N√£o tenho conta. Cadastrar!";
            }
        }

        function register() {
            const nome = document.getElementById('log-nome').value;
            const pass = document.getElementById('log-pass').value;
            if(!nome || !pass) return toast("Preencha tudo!");
            
            const role = (nome === "Tutu Prot√°sio" && pass === "172244") ? "Dono" : "Leitor";
            const user = { nome, role, pfp: tempImg || "https://via.placeholder.com/50", pass };
            
            db.ref('users/' + nome.replace(/\s/g, '_')).set(user).then(() => {
                currentUser = user;
                localStorage.setItem('g1_session', JSON.stringify(user));
                toast("Conta criada com sucesso!");
                renderAuthUI();
            });
        }

        function login() {
            const nome = document.getElementById('log-nome').value;
            const pass = document.getElementById('log-pass').value;
            
            db.ref('users/' + nome.replace(/\s/g, '_')).once('value', s => {
                const u = s.val();
                if(u && u.pass === pass) {
                    currentUser = u;
                    localStorage.setItem('g1_session', JSON.stringify(u));
                    toast("Bem-vindo de volta!");
                    renderAuthUI();
                    checkAdminAccess();
                } else {
                    toast("Usu√°rio ou senha incorretos.");
                }
            });
        }

        function logout() {
            localStorage.removeItem('g1_session');
            currentUser = null;
            location.reload();
        }

        function updateHeader() {
            if(currentUser) {
                document.getElementById('nav-user').innerText = currentUser.nome;
                document.getElementById('nav-pfp').src = currentUser.pfp;
            }
        }

        // --- ADMIN SYSTEM ---
        function checkAdminAccess() {
            const lock = document.getElementById('admin-lock');
            const panel = document.getElementById('admin-panel');
            if(currentUser && (currentUser.role === 'Dono' || currentUser.role === 'Jornalista')) {
                lock.style.display = 'none';
                panel.style.display = 'block';
                if(currentUser.role === 'Dono') document.getElementById('dono-only').style.display = 'block';
            } else {
                lock.style.display = 'block';
                panel.style.display = 'none';
            }
        }

        function publishNews() {
            const title = document.getElementById('n-titulo').value;
            const sub = document.getElementById('n-sub').value;
            const body = document.getElementById('n-texto').value;
            const cat = document.getElementById('n-tema').value;
            const autor = document.getElementById('n-autor').value;

            if(!title || !sub || !body || !tempImg) return toast("Todos os campos e a foto s√£o obrigat√≥rios!");

            const post = {
                title, sub, body, cat, autor,
                img: tempImg,
                views: 0,
                likes: 0,
                unlikes: 0,
                date: new Date().toLocaleString('pt-BR'),
                timestamp: Date.now()
            };

            db.ref('posts').push(post).then(() => {
                toast("Not√≠cia Publicada!");
                navigate('home');
                tempImg = "";
                document.getElementById('n-prev').style.display = 'none';
            });
        }

        function saveClima() {
            const val = document.getElementById('cfg-clima').value;
            db.ref('config/clima').set(val).then(() => toast("Clima atualizado!"));
        }

        // --- NEWS FEED ---
        function renderFeed(data = allNews) {
            const feed = document.getElementById('news-feed');
            feed.innerHTML = "";
            
            const filtered = currentFilter === "Todas" ? data : data.filter(n => n.cat === currentFilter);
            
            if(filtered.length === 0) {
                feed.innerHTML = `<p style="text-align:center; padding:50px;">Nenhuma not√≠cia encontrada em ${currentFilter}.</p>`;
                return;
            }

            filtered.sort((a,b) => b.timestamp - a.timestamp).forEach((n, i) => {
                const card = `
                    <div class="news-card" onclick="openNews('${n.id}')">
                        <img src="${n.img}" class="news-img">
                        <span class="cat">${n.cat}</span>
                        <h2 class="title">${n.title}</h2>
                        <p class="sub">${n.sub}</p>
                        <small style="color:#999; font-size:10px;">${n.date} ‚Ä¢ g1 Brookasil</small>
                    </div>`;
                feed.innerHTML += card;
            });
            renderTrending();
        }

        function renderTrending() {
            const list = document.getElementById('trending-list');
            list.innerHTML = "";
            const sorted = [...allNews].sort((a,b) => (b.views || 0) - (a.views || 0)).slice(0, 5);
            sorted.forEach((n, i) => {
                list.innerHTML += `
                    <div class="trending-item" onclick="openNews('${n.id}')">
                        <span class="rank">${i+1}</span>
                        <p class="trending-text" style="font-weight:700; font-size:13px;">${n.title}</p>
                    </div>`;
            });
        }

        function setFilter(cat, btn) {
            currentFilter = cat;
            document.querySelectorAll('#filter-bar button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderFeed();
        }

        function searchNews() {
            const term = document.getElementById('search-in').value.toLowerCase();
            const res = allNews.filter(n => n.title.toLowerCase().includes(term) || n.sub.toLowerCase().includes(term));
            renderFeed(res);
        }

        function openNews(id) {
            activePostId = id;
            db.ref('posts/'+id).once('value', s => {
                const n = s.val();
                db.ref('posts/'+id+'/views').set((n.views || 0) + 1);
                
                document.getElementById('modal-data').innerHTML = `
                    <span class="cat">${n.cat}</span>
                    <h1 class="modal-title">${n.title}</h1>
                    <p class="modal-sub">${n.sub}</p>
                    <div style="margin-bottom:20px; font-size:13px; color:#666;">Por <strong>${n.autor}</strong>, g1 Brookasil ‚Äî Brookasil</div>
                    <img src="${n.img}" style="width:100%; border-radius:8px; margin-bottom:30px;">
                    <div class="modal-content">${n.body.replace(/\n/g, '<br><br>')}</div>
                `;
                document.getElementById('v-likes').innerText = n.likes || 0;
                document.getElementById('v-unlikes').innerText = n.unlikes || 0;
                document.getElementById('modal-view').style.display = 'block';
                document.body.style.overflow = 'hidden';
            });
        }

        function closeModal() {
            document.getElementById('modal-view').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function react(type) {
            if(!currentUser) return toast("Fa√ßa login para reagir!");
            db.ref(`posts/${activePostId}/${type}`).transaction(c => (c || 0) + 1);
            db.ref(`posts/${activePostId}/${type}`).once('value', s => {
                document.getElementById('v-'+type).innerText = s.val();
            });
            toast("Obrigado pela intera√ß√£o!");
        }

        // --- UTILS ---
        function previewImg(input, target) {
            const reader = new FileReader();
            reader.onload = e => {
                tempImg = e.target.result;
                const p = document.getElementById(target);
                p.src = e.target.result; p.style.display = 'block';
            };
            if(input.files[0]) reader.readAsDataURL(input.files[0]);
        }

        function initApp() {
            // Rel√≥gio
            setInterval(() => {
                document.getElementById('relogio-display').innerText = new Date().toLocaleTimeString('pt-BR');
            }, 1000);

            // Clima
            db.ref('config/clima').on('value', s => {
                document.getElementById('clima-display').innerText = s.val() || "‚òÄÔ∏è ENSOLARADO: 28¬∞C";
            });

            // Ano Novo
            const now = new Date();
            if(now.getMonth() === 11 && now.getDate() >= 25) {
                document.getElementById('ny-banner').style.display = 'block';
                const target = new Date(now.getFullYear() + 1, 0, 1);
                setInterval(() => {
                    const diff = target - new Date();
                    const h = Math.floor(diff / 3600000);
                    const m = Math.floor((diff % 3600000) / 60000);
                    const s = Math.floor((diff % 60000) / 1000);
                    document.getElementById('countdown').innerText = `Contagem Regressiva: ${h}h ${m}m ${s}s`;
                }, 1000);
            }

            // Sync News
            db.ref('posts').on('value', s => {
                allNews = [];
                s.forEach(child => {
                    allNews.push({ id: child.key, ...child.val() });
                });
                renderFeed();
            });

            updateHeader();
        }

        initApp();
    </script>
</body>
</html>
