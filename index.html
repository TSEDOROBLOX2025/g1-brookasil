<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>g1 - Brookasil Oficial</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --g1-red: #C4170C; --bg: #f6f6f6; --text: #111; --border: #ddd; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Open Sans', sans-serif; background: var(--bg); color: var(--text); }

        /* HEADER */
        header { background: var(--g1-red); color: white; height: 65px; position: sticky; top: 0; z-index: 2000; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .logo { font-size: 38px; font-weight: 800; letter-spacing: -3px; color: white; text-decoration: none; cursor: pointer; }
        .logo span { font-weight: 400; font-size: 18px; letter-spacing: 0; margin-left: 5px; }
        
        .user-badge { display: flex; align-items: center; gap: 10px; background: rgba(0,0,0,0.1); padding: 5px 15px; border-radius: 25px; cursor: pointer; }
        .user-badge img { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; background: #fff; }

        /* NAV BAR */
        .topics-nav { background: white; border-bottom: 1px solid var(--border); display: flex; justify-content: center; overflow-x: auto; position: sticky; top: 65px; z-index: 1000; }
        .topics-nav a { padding: 15px 20px; color: var(--g1-red); text-decoration: none; font-size: 12px; font-weight: 800; text-transform: uppercase; cursor: pointer; }
        .topics-nav a:hover { background: #eee; }

        .container { max-width: 1100px; margin: 20px auto; padding: 0 15px; }
        .section { display: none; }
        .section.active { display: block; }

        /* CARDS */
        .news-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .news-card { background: white; border-bottom: 1px solid var(--border); cursor: pointer; }
        .news-card-img { width: 100%; height: 200px; object-fit: cover; }
        .news-card-body { padding: 15px; }
        .category { color: var(--g1-red); font-size: 11px; font-weight: 800; text-transform: uppercase; }
        .title { font-size: 22px; font-weight: 800; margin: 10px 0; line-height: 1.2; }

        /* FORMUL√ÅRIOS */
        .box { background: white; padding: 30px; border-radius: 5px; max-width: 600px; margin: 0 auto; border: 1px solid #ddd; }
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; }
        .btn { background: var(--g1-red); color: white; border: none; padding: 15px; width: 100%; font-weight: 800; cursor: pointer; border-radius: 4px; }

        /* MODAL */
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 3000; overflow-y: auto; padding: 40px 20px; }
    </style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center; gap:20px;">
        <div onclick="showSection('admin')" style="cursor:pointer; font-size:24px;">‚ò∞</div>
        <a class="logo" onclick="location.reload()">g1<span>Brookasil</span></a>
    </div>
    <div class="user-badge" onclick="showSection('profile')">
        <img id="nav-img" src="">
        <span id="nav-name">Entrar</span>
    </div>
</header>

<div class="topics-nav" id="main-nav">
    <a onclick="loadFeed('Tudo')">Tudo</a>
    <a onclick="loadFeed('Pol√≠tica')">Pol√≠tica</a>
    <a onclick="loadFeed('Policial')">Policial</a>
    <a onclick="loadFeed('Cidades')">Cidades</a>
    <a onclick="loadFeed('Sa√∫de')">Sa√∫de</a>
</div>

<div class="container">
    <section id="sec-feed" class="section active">
        <div id="feed" class="news-grid">
            <p style="text-align:center; grid-column: 1/-1;">Carregando not√≠cias...</p>
        </div>
    </section>

    <section id="sec-profile" class="section">
        <div class="box">
            <h2>üë§ Meu Perfil</h2>
            <center><img id="p-prev" style="width:100px; height:100px; border-radius:50%; object-fit:cover; display:none; margin:15px;"></center>
            <input type="text" id="p-nome" placeholder="Nome Completo">
            <textarea id="p-bio" placeholder="Sua biografia"></textarea>
            <label>Foto de Perfil (Galeria):</label>
            <input type="file" accept="image/*" onchange="encodeImg(this, 'p-prev')">
            <button class="btn" onclick="saveProfile()">Salvar Perfil</button>
        </div>
    </section>

    <section id="sec-admin" class="section">
        <div class="box">
            <div id="auth">
                <h2>Acesso Restrito</h2>
                <input type="password" id="pass" placeholder="Senha do Painel">
                <button class="btn" onclick="login()">Entrar</button>
            </div>
            <div id="panel" style="display:none;">
                <h2 id="adm-title">Painel</h2>
                <div id="dono-only" style="display:none;">
                    <input type="text" id="clima-in" placeholder="Ex: üå§Ô∏è Sol: 30¬∞C">
                    <button class="btn" style="background:#333" onclick="db.ref('clima').set(document.getElementById('clima-in').value)">Mudar Clima</button>
                    <hr style="margin:20px 0;">
                </div>
                <h3>Postar Not√≠cia</h3>
                <input type="text" id="n-tit" placeholder="T√≠tulo">
                <input type="text" id="n-sub" placeholder="Subt√≠tulo">
                <input type="text" id="n-aut" placeholder="Autor">
                <select id="n-cat">
                    <option>Pol√≠tica</option><option>Policial</option><option>Cidades</option><option>Sa√∫de</option>
                </select>
                <textarea id="n-txt" rows="6" placeholder="Texto da not√≠cia"></textarea>
                <input type="file" accept="image/*" onchange="encodeImg(this, 'n-prev')">
                <img id="n-prev" style="width:100%; display:none; margin:10px 0;">
                <button class="btn" onclick="publish()">Publicar</button>
            </div>
        </div>
    </section>
</div>

<div id="modal">
    <div style="max-width:800px; margin: 0 auto;">
        <button class="btn" style="width:auto; background:#666" onclick="closeModal()">‚Üê Voltar</button>
        <div id="modal-body"></div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    const firebaseConfig = { databaseURL: "https://g1-brookasil-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let tempImg = "";

    function encodeImg(input, prevId) {
        const reader = new FileReader();
        reader.onload = e => { 
            tempImg = e.target.result; 
            document.getElementById(prevId).src = tempImg;
            document.getElementById(prevId).style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('sec-' + id).classList.add('active');
    }

    function saveProfile() {
        const p = { nome: document.getElementById('p-nome').value, bio: document.getElementById('p-bio').value, foto: tempImg };
        localStorage.setItem('g1_user', JSON.stringify(p));
        location.reload();
    }

    function login() {
        const p = document.getElementById('pass').value;
        if(p === "Brookasil1234" || p === "G1_Brookasil") {
            document.getElementById('auth').style.display = 'none';
            document.getElementById('panel').style.display = 'block';
            if(p === "Brookasil1234") document.getElementById('dono-only').style.display = 'block';
        } else alert("Senha errada!");
    }

    function publish() {
        const data = {
            titulo: document.getElementById('n-tit').value,
            subtitulo: document.getElementById('n-sub').value,
            autor: document.getElementById('n-aut').value,
            tema: document.getElementById('n-cat').value,
            texto: document.getElementById('n-txt').value,
            foto: tempImg,
            data: new Date().toLocaleString(),
            ts: Date.now()
        };
        db.ref('posts').push(data).then(() => location.reload());
    }

    function loadFeed(tema = 'Tudo') {
        showSection('feed');
        db.ref('posts').orderByChild('ts').on('value', snap => {
            const feed = document.getElementById('feed');
            feed.innerHTML = "";
            let posts = [];
            snap.forEach(c => { let p = c.val(); p.id = c.key; posts.push(p); });
            posts.reverse().forEach(p => {
                if(tema === 'Tudo' || p.tema === tema) {
                    feed.innerHTML += `
                        <div class="news-card" onclick="openPost('${p.id}')">
                            <img src="${p.foto}" class="news-card-img">
                            <div class="news-card-body">
                                <span class="category">${p.tema}</span>
                                <h2 class="title">${p.titulo}</h2>
                                <p style="color:#666; font-size:14px;">${p.subtitulo}</p>
                            </div>
                        </div>`;
                }
            });
            if(feed.innerHTML === "") feed.innerHTML = "Nenhuma not√≠cia nesta categoria.";
        });
    }

    function openPost(id) {
        db.ref('posts/'+id).once('value', s => {
            const p = s.val();
            document.getElementById('modal-body').innerHTML = `
                <h1 style="font-size:35px; margin:20px 0;">${p.titulo}</h1>
                <p style="color:#666">${p.subtitulo}</p>
                <hr style="margin:15px 0;">
                <small>Por <b>${p.autor}</b> ‚Äî ${p.data}</small>
                <img src="${p.foto}" style="width:100%; margin:20px 0; border-radius:5px;">
                <p style="font-size:18px; line-height:1.7;">${p.texto.replace(/\n/g, '<br><br>')}</p>
            `;
            document.getElementById('modal').style.display = 'block';
        });
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    window.onload = () => {
        const u = JSON.parse(localStorage.getItem('g1_user'));
        if(u) {
            document.getElementById('nav-name').innerText = u.nome;
            document.getElementById('nav-img').src = u.foto;
            document.getElementById('p-nome').value = u.nome;
            document.getElementById('p-bio').value = u.bio;
        }
        loadFeed('Tudo');
    };
</script>
</body>
</html>
